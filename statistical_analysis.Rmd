```{r}
reservations = read.csv("Hotel Reservations.csv")
reservations
```
In this dataset, our response is the booking status, and the rest of the variables will be our predictors. However, we do not yet know if these predictors are good or not. 

There are 18 predictors and our goal is to knock them down to a workable number.

The first predictor in the dataset is booking_ID. Of course, this data is obviously not correlated with the booking_status as it is simply a way for us to order the individuals who cancel or commit their bookings. This will not be considered as a valid predictor. 

```{r}
reservations = reservations %>% mutate(stringdate = paste(as.character(arrival_date),as.character(arrival_month), sep = ",")) %>% mutate(stringdate2 = paste(stringdate, as.character(arrival_year), sep = ",")) %>% mutate(dateobject=as.Date(stringdate2, format = "%d,%m,%Y")) %>% select(-c(stringdate, stringdate2))
reservations = reservations %>% mutate(numerated = ifelse(booking_status == "Canceled", 1, 0)) %>% mutate(previous_booking_fixed = ifelse(repeated_guest == 0, 0.5, (no_of_previous_bookings_not_canceled)/(no_of_previous_cancellations + no_of_previous_bookings_not_canceled)))

```


```{r}
library("tidyverse")
library(corrplot)
correlation = cor(reservations %>% select(no_of_adults, no_of_children, no_of_weekend_nights, no_of_week_nights, required_car_parking_space, lead_time, repeated_guest, no_of_previous_cancellations, no_of_previous_bookings_not_canceled, avg_price_per_room, no_of_special_requests, numerated))
corrplot(correlation, tl.srt = 40)
```

Before we look at each variable seperately, we should look at the general correlation plot for us to get an idea about the highly correlated predictors. Of course, on main issue with this is that it is difficult for us to calculate an exact value of correlation for categorical/binary variables. However, these plot will give us a good spot for us to start. 

No of Children and adults
```{r}
mosaicplot(booking_status~no_of_adults,data=reservations)
mosaicplot(booking_status~no_of_children, data = reservations)

```

When plotting these two variables together, we can see that the response of a customer cancelling their reservation does not correlate significantly with the number of adults or children whom the room is reserved for. 

Hence, these variables should probably be dropped from the regression

No of Weekend and Weekdays
```{r}
mosaicplot(booking_status~no_of_weekend_nights,data=reservations)
mosaicplot(booking_status~no_of_week_nights, data = reservations)
```

We can see that there is a weak correlation between weekend nights and weekday nights, but not enough to warrant an inclusion in the final dataset. However, there is a chance that we will be able to mutate it into a single column which will be vital to the dataset. 


required car parking
```{r}
parking_space = xtabs(~ required_car_parking_space+numerated, data = reservations %>% select(numerated, required_car_parking_space))
parking_space
chisq.test(parking_space)
cramerV(parking_space)
```

Based on these results, it seems that the required parking space may have an effect on the booking_status so it should be kept in the dataset.  

Based on the correlationplot, lead time has the highest correlation with the response booking_status. However, we will have to dig deeper to verify this for sure. 

```{r}
simple.leadtime.regression= glm(numerated~ lead_time, family = binomial, data = reservations)
summary(simple.leadtime.regression)
```
```{r}
boxplot(reservations$booking_status, reservations$lead_time)
```

As we can see, lead time does play a significant role in determining the booking_status and hence should be kept in the model. 


The day of the year very much does matter when a person books hotel. This is true because this dataset comes from hotel records from portugal, a country that is a prime example of a tourist heavy country. 
However, due to the nature of the data we cannot run a correlation function on this. 

```{r}
library("tidyverse")
seasons_vs_cancellations = reservations %>% select(canceled, month) %>% group_by(month)  %>% summarize(average_cancellations =sum(canceled)/n())
barplot(seasons_vs_cancellations$average_cancellations, names.arg = seasons_vs_cancellations$month, xlab = "Month Number", ylab = "Probability of Cancellation")
```{r}

```